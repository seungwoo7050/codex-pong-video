# v0.1.0 인프라 설계: 로컬 개발 스택

## 1. 목적 / 범위
- Docker Compose로 백엔드, 프런트엔드, MariaDB, Redis, Nginx를 한 번에 기동한다.
- 한국 시간대 및 utf8mb4 설정을 기본으로 맞춘다.

## 2. 서비스 구성
- `db` (MariaDB 11)
  - 포트: 3306
  - 환경변수: `MARIADB_DATABASE=codexpong`, `MARIADB_USER/PASSWORD=codexpong`.
  - 문자셋: `utf8mb4_general_ci`.
- `redis` (옵션)
  - 포트: 6379, AOF 비활성화.
- `backend`
  - 빌드: `backend/Dockerfile` (Gradle로 bootJar 생성 후 JRE 런타임).
  - 환경: DB 접속 정보, `TZ=Asia/Seoul`.
- `frontend`
  - 빌드: `frontend/Dockerfile` (Vite 빌드 후 dev 서버).
  - 환경: `VITE_BACKEND_URL`, `VITE_BACKEND_WS`.
- `nginx`
  - 빌드: `infra/nginx/Dockerfile`.
  - 라우팅: `/api`와 `/ws` → backend, `/` → frontend.

## 3. 네트워크 / 포트
- 호스트 공개 포트
  - 80 (nginx), 8080 (backend 직접 확인용), 5173 (Vite dev), 3306 (DB), 6379 (Redis).
- 기본 네트워크는 docker-compose 기본 브리지 사용.

## 4. 설정 파일
- `infra/nginx/conf.d/default.conf`
  - WebSocket 업그레이드 헤더 포함.
  - 한국어 주석으로 라우팅 의도 설명.
- `backend/src/main/resources/application.properties`
  - DB 호스트를 환경변수로 받아 docker-compose와 호환.

## 5. 운영 / 테스트 플로우
1) `docker compose build --progress=plain`로 이미지 빌드.
2) `docker compose up -d`로 서비스 기동.
3) 브라우저에서 `http://localhost/` 접속 → 랜딩/로비/게임 화면 확인.
4) `/api/health` 응답 및 WebSocket 에코를 통해 연동 확인.

## 6. 향후 작업
- v0.2.0 이후 TLS/도메인 설정을 Nginx에 추가.
- 모니터링 스택(Prometheus/Grafana) 추가 시 compose 확장.
